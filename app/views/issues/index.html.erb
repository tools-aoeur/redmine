<%
  ZAppEngine.start_capture_requested_assets
  overrides = @project.nil? ? [] : ViewOverride.issue_list
                                               .active_instance
                                               .select { |vo| vo.matches?(project: @project) }
  results = {}
  overrides.map do |override|
    snippet = override.vo_code_snippet
    results[override] = render_snippet(snippet, { view_override: override })
  end
%>
<%= render partial: 'z_app_engine/requested_assets' %>
<% if overrides.any?  %>
  <div class="card">
    <!-- Tabs for the templates -->
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" href='#index' role="tab" data-toggle="tab">
          Index
        </a>
      </li>

      <% overrides.each do |override| %>
        <li class="nav-item">
          <a class="nav-link" href='#<%= override.name.gsub(/\s+/, '') %>' role="tab" data-toggle="tab">
            <%= override.name %>
          </a>
        </li>
      <% end %>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <div class="tab-pane active" role="tabpanel" id="index">
        <div>
          <%= render :parent %>
        </div>
      </div>

      <% overrides.each do |override| %>
        <div class="tab-pane" role="tabpanel" id="<%= override.name.gsub(/\s+/, '') %>">
          <div>
            <%= results[override] %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% else %>
  <%= render partial: 'original_index' %>
<% end %>
